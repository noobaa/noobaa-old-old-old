<div class="feeder">
	<div class="container">

		<div class="text-center" style="margin-bottom: 15px" ng-if="nbUser.user">
			<button class="btn btn-default" ng-click="refresh_feeds()" title="Click to refresh" rel="tooltip" data-placement="bottom">
				<i class="fa fa-refresh {{fetching_feeds && 'fa-spin' || ''}} fa-fw"></i>
			</button>
			<div style="display: inline-block; max-width: 170px; vertical-align: middle">
				<div Xclass="input-group" style="position: relative">
					<input type="text" class="form-control {{search_feed.query && 'label-primary'}}" maxlength="100" placeholder="Search feed" ng-model="search_feed.query" ng-change="search_feed_changed()" />
					<i class="fa fa-times fa-fw" style="cursor: pointer; position: absolute; right: 10px; top: 11px" ng-click="search_feed.query = search_feed_changed()"></i>
				</div>
			</div>
		</div>

		<div class="feeds_container row">

			<div ng-if="feeds && !feeds.length && !fetching_feeds && !search_feed.query" class="text-center" style="padding: 20px">
				<iframe width="400" height="225" style="max-width: 100%" src="//www.youtube.com/embed/9KeVa3IOn78?rel=0" frameborder="0" allowfullscreen></iframe>
				<div style="padding-top: 20px">
					<a class="btn btn-link btn-lg" style="padding: 5px" href="/home/friends/">
						<i class="fa fa-users fa-lg fa-fw"></i>
						<span>Invite Your Friends</span>
					</a>
				</div>
			</div>

			<div ng-repeat="feed in feeds" ng-controller="FeedCtrl" class="feed_item col-xs-12 col-sm-6 col-md-4 col-lg-3">

				<div class="panel panel-default" style="margin: 15px 10px; border-radius: 4px; overflow: hidden">

					<div class="panel-body hover-target" style="{{expanded && 'min-height' || 'height'}}: 200px; padding: 0; position: relative; overflow: hidden">
						<div ng-if="current_entry().content_kind != 'image'" class="text-center">
							<br/>
							<span class="label label-default">Add image for preview</span>
						</div>
						<div ng-if="current_entry().content_kind == 'image'" nb-media="current_entry()" media-events="media_events" style="width: 100%; height: 100%"></div>
						<div class="text-center cover show-hover-only" style="padding-top: 60px">
							<a class="btn btn-primary btn-lg white-shadow" ng-click="play_feed_inode(current_inode)">
								<i class="fa fa-play fa-fw fa-2x"></i>
							</a>
						</div>
					</div>

					<div class="panel-footer clearfix" style="padding: 0; font-weight: normal">

						<div style="overflow: hidden">
							<div class="text-ellipses">
								<a class="btn btn-link btn-sm text-ellipses" style="max-width: 100%; padding-left: 5px" ng-click="open_feed_inode(current_inode)">
									<small>
										<i class="fa fa-{{nbUtil.icon_by_kind(current_inode.content_kind)}} fa-fw fa-lg"></i>
										{{feed.name}}
									</small>
								</a>
							</div>
						</div>

						<div ng-show="expanded" class="pullDown">
							<div ng-repeat="feed_inode in feed.inodes track by $index" style="padding: 7px; border-top: 1px solid hsl(210,10%,90%)" class="hover-target" ng-init="comment_box={inode: feed_inode}">
								<div style="overflow: hidden">
									<img class="img-circle" ng-src="{{nbUser.user_pic_url(feed_inode.ref_owner || nbUser.user)}}" style="width: 30px; height: 30px; margin-right: 5px; vertical-align: top" />
									<small>
										<small class="text-primary"><b>{{(feed_inode.ref_owner || nbUser.user).first_name}}</b>
										</small>
									</small>
									<a class="btn btn-link btn-lg pull-right" ng-click="comment_box.show = !comment_box.show" title="Add comment" rel="tooltip" nb-tooltip="{placement: 'bottom'}" style="padding: 2px 7px">
										<i class="fa fa-reply-all"></i>
									</a>
									<a class="btn btn-link btn-lg pull-right" ng-click="open_feed_inode(feed_inode)" title="Go to item" rel="tooltip" nb-tooltip="{placement: 'bottom'}" style="padding: 2px 7px">
										<i class="fa fa-file-o text-muted"></i>
									</a>
								</div>
								<div style="margin-left: 25px">
									<div ng-repeat="msg in feed_inode.messages" class="clearfix">
										<img class="img-circle pull-left" ng-src="{{nbUser.user_pic_url(msg.user)}}" style="width: 30px; margin-right: 5px; vertical-align: top" />
										<div style="overflow: hidden">
											<div class="Xtext-wrap">
												<small>
													<small class="text-primary"><b>{{msg.user.first_name}}</b>
													</small>
													<small>
														<span style="white-space: pre-wrap" ng-bind-html="msg.text | linky:'_blank'"></span>
													</small>
												</small>
											</div>
											<div>
												<small>
													<small class="text-muted">
														{{moment(msg.create_time).fromNow()}}
														<a class="visible-hover-only" ng-click="nbInode.delete_inode_message(feed_inode, msg)" ng-if="msg.is_mine">
															<i class="fa fa-times fa-fw text-muted"></i>
														</a>
													</small>
												</small>
											</div>
										</div>
									</div>
									<div ng-if="comment_box.show" class="clearfix">
										<img class="img-circle pull-left" ng-src="{{nbUser.user_pic_url(nbUser.user)}}" style="width: 30px; height: 30px; margin-right: 5px" />
										<div style="overflow: hidden">
											<textarea ng-model="comment_box.text" rows="1" class="form-control" style="resize: none" placeholder="Write about it..." nb-focus="comment_box.show" ng-attr-tabindex="{{($index*10)+100}}" nb-auto-height></textarea>
											<div class="text-center" style="padding-top: 5px">
												<button class="btn btn-info btn-hover-only" ng-click="post_comment(comment_box)" ng-disabled="comment_box.posting" ng-attr-tabindex="{{($index*10)+101}}">
													&nbsp;&nbsp;&nbsp;&nbsp; Send
													<span ng-if="comment_box.posting">
														<i class="fa fa-spin fa-spinner"></i>
													</span>
													&nbsp;&nbsp;&nbsp;&nbsp;
												</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div>
							<a ng-click="expanded = !expanded" class="btn btn-sm {{expanded && 'btn-primary' || 'btn-link'}}" style="padding: 3px 5px; margin: 5px; text-decoration: none">
								<small class="{{expanded || 'text-primary'}}">
									{{feed.inodes.length}}
									<i class="fa fa-user"></i>
									&nbsp; {{num_messages()}}
									<i class="fa fa-comments"></i>
									&nbsp;
									<i class="fa fa-caret-{{expanded && 'up' || 'down'}}"></i>
								</small>
							</a>
							<a ng-show="done_keep()" class="btn btn-link btn-sm" ng-click="open_feed_inode(current_inode)" style="padding: 0; margin: 5px">
								<small class="text-muted">
									<i class="fa fa-check"></i> Keep
								</small>
							</a>
							<a ng-show="!done_keep()" class="btn btn-link btn-sm" ng-click="keep_feed()" ng-disabled="running_keep()" style="padding: 0; margin: 5px">
								<small class="text-danger">
									<span ng-if="running_keep()">
										<i class="fa fa-spin fa-spinner"></i>
									</span>
									<span ng-if="!running_keep()">
										<i class="fa fa-plus"></i>
									</span>
									Keep
								</small>
							</a>
							<a ng-show="current_inode.shr=='f'" class="btn btn-link btn-sm" ng-click="keep_and_share_feed()" style="padding: 0; margin: 5px">
								<small class="text-muted">
									<i class="fa fa-check"></i> Share
								</small>
							</a>
							<a ng-hide="current_inode.shr=='f'" class="btn btn-link btn-sm" ng-click="keep_and_share_feed()" style="padding: 0; margin: 5px">
								<small class="text-warning">
									<i class="fa fa-share-square-o"></i> Share
								</small>
							</a>
						</div>

					</div>

				</div>

			</div>

			<div class="clearfix"></div>
			<div class="text-center" ng-show="feeds.length && has_more_feeds">
				<button class="btn btn-default text-primary {{feed_scroll_timeout && 'tossing'}}" ng-click="more_feeds()" ng-disabled="fetching_feeds">
					Load more
					<span ng-if="fetching_feeds">
						<i class="fa fa-spinner fa-spin fa-lg"></i>
					</span>
				</button>
				<div style="height: 15px"></div>
				<div id="more_feeds_marker"></div>
			</div>

		</div>

	</div>
</div>
